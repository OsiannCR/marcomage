<?xml version="1.0" encoding="UTF-8"?>
<!--MArcomage keywords database (XML)-->
<keywords xmlns="http://arcomage.net">
  <keyword>
    <name>Alliance</name>
    <basic_gain>17</basic_gain>
    <bonus_gain>3</bonus_gain>
    <description>Arcane knowledge - additional Production x2.</description>
    <lore><![CDATA[
    <p>Alliance consists of many elven tribes that live mostly as nomads. Tribes have distinct traits, such as weapon skills, magic abilities and also they worship different deities. Each tribe has a keeper who functions as a leader and also performs spiritual services for the tribe. Some tribes have abandoned nomadic way of life, built cities and settled down. Elven tribes as a whole are ruled by the elven lord. The tribal keepers perform a sacred ritual every twenty years. Being a test of skill, this ritual will decide which one of the keepers will become the next elven lord for the upcoming ruling period. Ancient forest creatures guard elven lands, but at the time of need they can be summoned to bolster elven army.</p>
    <p>Alliance has the ability to produce resources very effectively. Elves are skilled in swordsmanship, archery and support magic. Large forest creatures fulfill the role of living siege machines. With the abundance of resources, the Alliance is always eager to trade and cooperate with other factions.</p>
]]></lore>
    <code><![CDATA[$t->production()->multiply(2);]]></code>
  </keyword>
  <keyword>
    <name>Aqua</name>
    <basic_gain>0</basic_gain>
    <bonus_gain>0</bonus_gain>
    <description>High tide - if an Aqua card is played after playing a different, non-common Aqua card, it raises your tower and wall by 3, opponent's stock is reduced by 3.</description>
    <lore><![CDATA[
    <p>Little is known about the deep sea creatures. They occasionally ambush a merchant ship or a lightly defended port, but few men came back to tell the tale. They are unmatched when they are in their element, often turning the tide of the battle - literally.</p>
    <p>The power of the deep sea creatures is reflected in the water itself - it has many shapes and forms ranging from destruction and sabotage to protection and healing.</p>
]]></lore>
    <code><![CDATA[
    if ($t->myLastCard()->hasKeyword('Aqua') && $t->myLastAction() == 'play'
      && $t->myLastCard()->getRarity() != 'Common' && $t->card()->id() != $t->myLastCard()->id()) {
      $t->myData()->addTower(3)->addWall(3);
      $t->hisData()->addStock(-3);
    }
]]></code>
  </keyword>
  <keyword>
    <name>Aria</name>
    <basic_gain>0</basic_gain>
    <bonus_gain>0</bonus_gain>
    <description>Wind of change - if Round is divisible by 5, discards N lowest cost common cards from hand, N based on played card rarity (C-1, U-2, R-4).</description>
    <lore><![CDATA[
    <p>Element of Air is often underestimated by novice mages, because other elements such as Fire produces much more immediate effects. Moreover, mastering it requires much effort and patience and even then it takes perfect timing to put it to good use. Successful execution however, is rewarded with the ability to dramatically change the conditions on the battlefield, thus producing unexpected turn of events and hampering opponent's strategy.</p>
]]></lore>
    <code><![CDATA[
    if (($t->round() % 5) == 0) {
      $storage = array();
      for ($i = 1; $i <= $t->handSize(); $i++) {
        if ($i != $t->cardPos()) {
          $cur_card = $this->getCard($t->myData()->Hand[$i]);
          if ($cur_card->getRarity() == 'Common') {
            $storage[$i] = $cur_card->getResources();
          }
        }
      }
      if (count($storage) > 0) {
        asort($storage);
        $amounts = ['Common' => 1, 'Uncommon' => 2, 'Rare' => 4];
        $amount = $amounts[$t->card()->getRarity()]; $i = 0;

        foreach ($storage as $discarded_pos => $cost) {
          if ($i == $amount) {
            break;
          }

          $this->setCard('my', $discarded_pos, $this->drawCard($t->myDeck(), $t->myData()->Hand, $discarded_pos, 'drawCardRandom'));
          $i++;
        }
      }
    }
]]></code>
  </keyword>
  <keyword>
    <name>Banish</name>
    <basic_gain>0</basic_gain>
    <bonus_gain>0</bonus_gain>
    <description>Discard highest rarity Durable, Persistent or Rebirth card from opponent's hand. Common cards can target common and uncommon cards, uncommon cards can target any rarity. Rare cards replace target card with a common zero cost card instead of discarding it.</description>
    <lore><![CDATA[<p>Banish is a spell that was invented solely for the purpose to counter the durable materials and render them useless. Banish can be cast directly on target or can be used to enchant a weapon to hold the banish property.</p>]]></lore>
    <code><![CDATA[
    // target card is discarded only if it has same or lower rarity than the played card
    $rarities = ['Common' => 0, 'Uncommon' => 1, 'Rare' => 2];
    $storage = ['Common' => array(), 'Uncommon' => array(), 'Rare' => array()];
    $played_rank = $rarities[$t->card()->getRarity()];
    $persistent = $this->getList(['advanced'=>'Replace a card in hand with self']);

    for ($i = 1; $i <= $t->handSize(); $i++) {
      $dis_card = $this->getCard($t->hisData()->Hand[$i]);
      $dis_rarity = $dis_card->getRarity();
      $dis_rank = $rarities[$dis_rarity];
      
      // pick only cards that can be discarded by played card
      if (($dis_card->hasKeyword('Durable') || $dis_card->hasKeyword('Rebirth') || in_array($t->hisData()->Hand[$i], $persistent)) && $dis_rank <= ($played_rank + 1)) {
        $storage[$dis_rarity][] = $i;
      }
    }
    
    if ((count($storage['Common']) + count($storage['Uncommon']) + count($storage['Rare'])) > 0) {
      // pick preferably cards with higher rarity, but choose random card within the rarity group
      shuffle($storage['Common']);
      shuffle($storage['Uncommon']);
      shuffle($storage['Rare']);
      $storage_temp = array_merge($storage['Common'], $storage['Uncommon'], $storage['Rare']);
      $discarded_pos = array_pop($storage_temp);
      
      if ($t->card()->getRarity() == 'Rare') {
        $new_card = $this->drawCard($this->getList(['rarity'=>'Common', 'cost'=>'Zero']), $t->hisData()->Hand, $discarded_pos, 'drawCardList');
      }
      else {
        $new_card = $this->drawCard($t->hisDeck(), $t->hisData()->Hand, $discarded_pos, 'drawCardDifferent');
      }
      $this->setCard('his', $discarded_pos, $new_card);
    }
]]></code>
  </keyword>
  <keyword>
    <name>Barbarian</name>
    <basic_gain>4</basic_gain>
    <bonus_gain>15</bonus_gain>
    <description>Devastation - enemy wall will be additionally lowered by amount based on played card rarity (Common - 3 , Uncommon - 8, Rare - 15). If there is no wall to destroy, enemy stock will be lowered by half the amount instead.</description>
    <lore><![CDATA[
    <p>Barbarians live in nomadic tribes that specialize in plundering villages and small towns. Though they are mostly unorganized, sometimes they form temporary alliances and share spoils of war. When facing a powerful enemy, the tribes often choose a warlord to lead them as a single unstoppable horde.</p>
    <p>Barbarians are able to raze fortifications to the ground and burn down buildings with deadly efficiency, plundering enemy resources in the process.</p>
]]></lore>
    <code><![CDATA[
    $damage = ['Common' => 3, 'Uncommon' => 8, 'Rare' => 15];
    if ($t->hisData()->Wall <= 0) {
      $penalty = round($damage[$t->card()->getRarity()] / 2);
      $t->hisData()->addStock(-$penalty);
    }
    else {
      $t->hisData()->addWall(-$damage[$t->card()->getRarity()]);
    }
]]></code>
  </keyword>
  <keyword>
    <name>Brigand</name>
    <basic_gain>10</basic_gain>
    <bonus_gain>10</bonus_gain>
    <description>Robbery - additional stock will be stolen from opponent, amount based on played card rarity (Common - 1 stock, Uncommon - 2 stock, Rare - 3 stock).</description>
    <lore><![CDATA[
    <p>In most cities there are thieves guilds present, although most officials deny their very existence. Most nobles are trying to be on good terms with local thieves guild. A band of merciless thieves and deadly assassins are a powerful ally and a dangerous opponent.</p>
    <p>Brigands specialize in stealing resources, thus crippling the enemy before they can do harm.</p>
]]></lore>
    <code><![CDATA[
    $stock = ['Common' => 1, 'Uncommon' => 2, 'Rare' => 3];
    $this->stealStock('my', $stock[$t->card()->getRarity()]);
]]></code>
  </keyword>
  <keyword>
    <name>Beast</name>
    <basic_gain>5</basic_gain>
    <bonus_gain>7</bonus_gain>
    <description>Breeding - doubles recruits production and opponent receives bonus damage based on recruits production (max N, N based on played card rarity (Common - 2, Uncommon - 5, Rare - 10)).</description>
    <lore><![CDATA[
    <p>Wild beasts usually operate in pacts and are known for their ferocity. Several factions were able to tame some beast and incorporated them into their armies. Beasts are able to perform many different roles such as mounts, unmounted cavalry or frontline soldiers.</p>
    <p>Agility and nimbleness of a beast greatly surpasses human limitations. Armed with claws, teeth and killer instinct, bred in great numbers, the beasts are cheaper and more expendable than regular soldiers.</p>
]]></lore>
    <code><![CDATA[
    $caps = ['Common' => 2, 'Uncommon' => 5, 'Rare' => 10];
    $cap = $caps[$t->card()->getRarity()];
    $t->production()->multiplyRecruits(2);
    $t->hisData()->attack(min($t->myData()->Dungeons * $t->production()->recruits(), $cap));
    ]]></code>
  </keyword>
  <keyword>
    <name>Burning</name>
    <basic_gain>3</basic_gain>
    <bonus_gain>11</bonus_gain>
    <description>Fire blast - replace highest rarity non-Burning card from opponent's hand of the same or lower rarity as the played card with [card=248/].</description>
    <lore><![CDATA[
    <p>It is said that burning creatures are those who were blessed by the sun god himself. Others say, that they are devil's pawns destines to serve him for eternity. Element of fire is know to consume everything eventually, but despite that many creatures are attracted by its power regardless of the price they have to pay to wield it.</p>
    <p>Burning creatures are able to accumulate their destructive power and completely destroy its target, leaving only burned ashes behind.</p>
]]></lore>
    <code><![CDATA[
    // target card is discarded only if it has same or lower rarity than the played card
    $rarities = ['Common' => 0, 'Uncommon' => 1, 'Rare' => 2];
    $storage = ['Common' => array(), 'Uncommon' => array(), 'Rare' => array()];
    $played_rank = $rarities[$t->card()->getRarity()];
    
    for ($i = 1; $i <= $t->handSize(); $i++) {
      $dis_card = $this->getCard($t->hisData()->Hand[$i]);
      $dis_rarity = $dis_card->getRarity();
      $dis_rank = $rarities[$dis_rarity];
      
      // pick only cards that can be discarded by played card
      if (!$dis_card->hasKeyword('Burning') && $dis_rank <= $played_rank) {
        $storage[$dis_rarity][] = $i;
      }
    }
    
    if ((count($storage['Common']) + count($storage['Uncommon']) + count($storage['Rare'])) > 0) {
      // pick preferably cards with higher rarity, but choose random card within the rarity group
      shuffle($storage['Common']);
      shuffle($storage['Uncommon']);
      shuffle($storage['Rare']);
      $storage_temp = array_merge($storage['Common'], $storage['Uncommon'], $storage['Rare']);
      $discarded_pos = array_pop($storage_temp);
      $this->setCard('his', $discarded_pos, 248, ['reveal' => true]);
    }
]]></code>
  </keyword>
  <keyword>
    <name>Charge</name>
    <basic_gain>0</basic_gain>
    <bonus_gain>0</bonus_gain>
    <description>When card has this keyword, it also has a number next to this keyword. When card is played and the opponent's wall (after the standard attack) is 0, he will receive additional damage equal to number next to charge, otherwise opponent loses random resources equal to number next to charge. If opponent has more resources of certain type compared to his other resources, they are more likely to be reduced.</description>
    <lore><![CDATA[<p>Some creatures are able to attack with such force and speed that they are able to stomp their enemies to the ground without the need to fight them with regular weapons. Heavy fortifications are the only defenses that can hold them at bay, however even they need to be repaired after the battle to hold another attack.</p>]]></lore>
    <code><![CDATA[
    $charge_damage = $this->keywordValue($t->card()->getData('Keywords'), 'Charge');
    if ($t->hisData()->Wall <= 0) {
      $t->hisData()->addTower(-$charge_damage);
    }
    else {
      $t->hisData()->addRandomResources(-$charge_damage);
    }
]]></code>
  </keyword>
  <keyword>
    <name>Cursed</name>
    <basic_gain>0</basic_gain>
    <bonus_gain>0</bonus_gain>
    <description>If a card with this keyword is discarded, it will be returned to its former position.</description>
    <lore><![CDATA[<p>Curse that is not from this world sometimes envelopes various objects. Experts still debate the origin of this curse but they all agree on one fact. Once the curse sets in there is little you can do to remove it.</p>]]></lore>
    <code><![CDATA[]]></code>
  </keyword>
  <keyword>
    <name>Demonic</name>
    <basic_gain>0</basic_gain>
    <bonus_gain>0</bonus_gain>
    <description>Wicked soul - player suffers one random penalty chosen from played card cost (Bricks - lose N random resources, Gems - N tower damage, Recruits - N wall damage), N based on played card's rarity (Common - 2 , Uncommon - 3, Rare - 4).</description>
    <lore><![CDATA[
    <p>Long ago Demons were the rulers of the world; some of them, the Darklords, were so powerful that even the Gods were afraid of them. For this reason the Gods sealed the Darklords and their armies in an empty dimension: the Void. But now, after many centuries, the seal has weakened and some Demons were able to return in this world to unleash an unspeakable evil.</p>
    <p>Demons are dangerous creatures with an incredible destructive power that it's impossible to control: not even Myr the Magelord could use them without great sacrificies.</p>
]]></lore>
    <code><![CDATA[
    $penalties = array();
    foreach (['Bricks', 'Gems', 'Recruits'] as $resource) {
      if ($t->card()->getResources($resource) > 0) {
        $penalties[] = $resource;
      }
    }
    if (count($penalties) > 0) {
      $rarities = ['Common' => 2, 'Uncommon' => 3, 'Rare' => 4];
      $amount = $rarities[$t->card()->getRarity()];
      $penalty = $penalties[$this->arrayRand($penalties)];

      if ($penalty == 'Bricks') {
        $t->myData()->addRandomResources(-$amount);
      }
      elseif ($penalty == 'Gems') {
        $t->myData()->addTower(-$amount); 
      }
      elseif ($penalty == 'Recruits') {
        $t->myData()->addWall(-$amount); 
      }
    }
]]></code>
  </keyword>
  <keyword>
    <name>Destruction</name>
    <basic_gain>0</basic_gain>
    <bonus_gain>0</bonus_gain>
    <description>Dark fury - if a Destruction card is played after playing a different non-common Destruction card, it reduces enemy's highest facility by 1 when it is greater than 3, otherwise it reduces opponent's highest resource by 6.</description>
    <lore><![CDATA[<p><i>Offense is the best defense</i> - the motto of every mage who mastered this dark art. Destruction magic contains spells that directly cripple the enemy which often prevent them to mount a counter-offensive. One warlock who wields the destruction magic at master level is able to annihilate whole armies in matter of seconds.</p>]]></lore>
    <code><![CDATA[
    if ($t->myLastCard()->hasKeyword('Destruction') && $t->myLastAction() == 'play' && $t->myLastCard()->getRarity() != 'Common' && $t->card()->id() != $t->myLastCard()->id()) {
      $max = max($t->hisData()->Quarry, $t->hisData()->Magic, $t->hisData()->Dungeons);
      if ($max > 3) {
        $t->hisData()->addHighestFacility(-1);
      }
      else {
        $t->hisData()->addHighestResource(-6);
      }
    }
]]></code>
  </keyword>
  <keyword>
    <name>Dragon</name>
    <basic_gain>0</basic_gain>
    <bonus_gain>0</bonus_gain>
    <description>Ancient legacy - if there is another Dragon in hand, summons [card=131/] (if there is no [card=131/] card in hand) or Gems production x2 (if there already is a [card=131/] card in hand).</description>
    <lore><![CDATA[<p>Dragons are one of the oldest known races. Rare and powerful, they are often hunted down by individuals who seek fame and glory. Most of such adventurers find something else entirely and are never heard of ever again.</p>]]></lore>
    <code><![CDATA[
    if ($this->keywordCount($t->myData()->Hand, 'Dragon') > 1) {
      $tmp = 0;
      for ($i = 1; $i <= $t->handSize(); $i++) {
        if ($t->myData()->Hand[$i] == 131) {
          $tmp++;
        }
      }

      if ($tmp > 0) {
        $t->production()->multiplyGems(2); // when there already is a dragon egg in hand add gems production
      }
      else {
        $t->nextCard(131, true); // add dragon egg otherwise
      }
    }
]]></code>
  </keyword>
  <keyword>
    <name>Durable</name>
    <basic_gain>0</basic_gain>
    <bonus_gain>0</bonus_gain>
    <description>Card stays in hand.</description>
    <lore><![CDATA[<p>The dwarves invented the durable materials so they could reuse them many times, which would save much resources. They usage of such materials quickly spread to other factions as well. With everyone relying on such materials it was only a matter of time before someone would found its weakness and exploit it. Thus the Banish spell which would render the durable materials useless was invented.</p>]]></lore>
    <code><![CDATA[$t->noNextCard(); $this->revealCard('my', $t->cardPos());]]></code>
  </keyword>
  <keyword>
    <name>Enduring</name>
    <basic_gain>0</basic_gain>
    <bonus_gain>0</bonus_gain>
    <description>When card has this keyword, it also has a number next to this keyword. When card is played and the last card played was same as this one, opponent will suffer additional damage equal to number next to Enduring.</description>
    <lore><![CDATA[<p>The battle often increases the capabilities of soldiers, but only for a short period of time mostly due to fatigue. However, there are creatures which have high endurance and are able to maintain battle trance without losing their strength. Such creatures tend to do more damage if they keep fighting for longer period of time.</p>]]></lore>
    <code><![CDATA[
    if ($t->myData()->LastCard[$t->myLastCardIndex()] == $t->card()->id() && $t->myLastAction() == 'play') {
      $bonus_damage = $this->keywordValue($t->card()->getData('Keywords'), 'Enduring');
      $t->hisData()->attack($bonus_damage);
    }
]]></code>
  </keyword>
  <keyword>
    <name>Far sight</name>
    <basic_gain>0</basic_gain>
    <bonus_gain>0</bonus_gain>
    <description>If matching card in opponent's hand is revealed, effect based on matching card cost and played card rarity (bricks only cost - raise tower (C - 2, U - 6, R - 18), gems only cost - raise lowest token counter (C - 10, U - 30, R - 90), recruits only cost - raise wall (C - 3, U - 9, R - 27), mixed cost - raise stock (C - 1, U - 3, R - 9), zero cost - no effect). After optional effect opponent's cards are revealed based on played card rarity (C - matching card and its adjacent cards, U - matching card and its adjacent cards and their adjacent cards, R - whole hand). Optional effect will always trigger in a game with disabled Hidden cards mode.</description>
    <lore><![CDATA[<p>Scouting is extremely important in any battle. Creatures blessed with much better sight than others are highly valued even if their combat capabilities are poor. Acting as veteran scouts in army ranks, they are used to spot incoming threat and even exploit opponent's weaknesses.</p>]]></lore>
    <code><![CDATA[
    if (!$t->hiddenCards() || isset($t->hisData()->Revealed[$t->cardPos()])) {
      // bonus effect
      $cur_card = $this->getCard($t->hisData()->Hand[$t->cardPos()]);
      $bricks = $cur_card->getResources('Bricks');
      $gems = $cur_card->getResources('Gems');
      $recruits = $cur_card->getResources('Recruits');
      $rarities = ['Common' => 1, 'Uncommon' => 3, 'Rare' => 9];
      $factor = $rarities[$t->card()->getRarity()];
      
      if ($bricks > 0 && $gems == 0 && $recruits == 0) {
        $t->myData()->addTower(2 * $factor);
      }
      elseif ($bricks == 0 && $gems > 0 && $recruits == 0) {
        // remove inactive token counters
        $my_tokens = array_diff($t->myData()->TokenNames, ['none']);

        // raise lowest token counter
        if (count($my_tokens) > 0) {
          $min = 1000;
          $chosen = array();
          foreach ($my_tokens as $i => $token_name) {
            $min = min($min, $t->myData()->TokenValues[$i]);
          }
          foreach ($my_tokens as $i => $token_name) {
            if ($t->myData()->TokenValues[$i] == $min) {
              $chosen[] = $i;
            }
          }
          $chosen_index = $chosen[array_rand($chosen)];
          $t->myData()->TokenValues[$chosen_index]+= 10 * $factor;
        }
      }
      elseif ($bricks == 0 && $gems == 0 && $recruits > 0) {
        $t->myData()->addWall(3 * $factor);
      }
      elseif ($bricks == 0 && $gems == 0 && $recruits == 0) {
        // no effect
      }
      else {
        $t->myData()->addStock($factor);// raise stock
      }
    }
    
    // reveal opponent's cards based on played card rarity
    $offsets = ['Common' => 1, 'Uncommon' => 2, 'Rare' => 8];
    $offset = $offsets[$t->card()->getRarity()];
    $start = max($t->cardPos() - $offset, 1);
    $finish = min($t->cardPos() + $offset, 8);
    
    for ($i = $start; $i <= $finish; $i++) {
      $this->revealCard('his', $i);
    }
]]></code>
  </keyword>
  <keyword>
    <name>Flare blitz</name>
    <basic_gain>0</basic_gain>
    <bonus_gain>0</bonus_gain>
    <description>Replace up to N lowest rarity non-<b>Burning</b> cards in each player's hand with [card=248/], N based on played card rarity (Common - 1, Uncommon - 2, Rare - 4).</description>
    <lore><![CDATA[<p>Many believe that flare blitz is only a legend, because thus far no one has ever seen one cast and survived. Only the most powerful legendary creatures are able to perform such a feat - often razing entire cities to the ground. There were multiple attempts to artificially replicate it based on ancient texts but the results would pale in comparison to the original effect.</p>]]></lore>
    <code><![CDATA[
    foreach (['my' => $t->myData(), 'his' => $t->hisData()] as $dataKey => $data) {
      $storage = ['Common' => [], 'Uncommon' => [], 'Rare' => []];
      $rarities = ['Common' => 1, 'Uncommon' => 2, 'Rare' => 4];
      $count = $rarities[$t->card()->getRarity()];
      for ($i = 1; $i <= $t->handSize(); $i++) {
        if ($dataKey == 'my' && $i == $t->cardPos()) {
          continue;
        }

        $currentCard = $t->getCard($data->Hand[$i]);
        if (!$currentCard->hasKeyword('Burning')) {
          $storage[$currentCard->getRarity()][] = $i;
        }
      }

      shuffle($storage['Common']);
      shuffle($storage['Uncommon']);
      shuffle($storage['Rare']);
      $storage = array_merge($storage['Common'], $storage['Uncommon'], $storage['Rare']);

      while ($count > 0 && count($storage) > 0) {
        $cardPos = array_shift($storage);
        $t->setCard($dataKey, $cardPos, 248);
        $count--;
      }
    }
]]></code>
  </keyword>
  <keyword>
    <name>Forbidden</name>
    <basic_gain>0</basic_gain>
    <bonus_gain>0</bonus_gain>
    <description>Card with this keyword can't be used in deck building.</description>
    <lore><![CDATA[<p>Ancient, forbidden and dangerous. Some things are better off sealed away far beyond the reach of any man.</p>]]></lore>
    <code><![CDATA[]]></code>
  </keyword>
  <keyword>
    <name>Frenzy</name>
    <basic_gain>0</basic_gain>
    <bonus_gain>0</bonus_gain>
    <description>Rage blast - if played card is adjacent to a Frenzy card, opponent receives bonus damage (recruits cost of the played card * N/3, N based on played card rarity (Common - 1, Uncommon - 2, Rare - 3)).</description>
    <lore><![CDATA[<p>Good generals are aware of the effect of army's high morale on its combat performance. Frenzy goes one step further. A frenzied creature is partially insane and can be dangerous to use, however when unleashed in the right time and right place it can break the enemy ranks and cause severe damage to the enemy.</p>]]></lore>
    <code><![CDATA[
    if (($t->cardPos() > 1 && $this->getCard($t->myData()->Hand[$t->cardPos() - 1])->hasKeyword('Frenzy'))
      || ($t->cardPos() < $t->handSize() && $this->getCard($t->myData()->Hand[$t->cardPos() + 1])->hasKeyword('Frenzy'))) {
      $rarities = ['Common' => 1, 'Uncommon' => 2, 'Rare' => 3];
      $coef = $rarities[$t->card()->getRarity()];
      $t->hisData()->attack(round(($coef * $t->card()->getResources('Recruits')) / 3));
    }
]]></code>
  </keyword>
  <keyword>
    <name>Holy</name>
    <basic_gain>25</basic_gain>
    <bonus_gain>5</bonus_gain>
    <description>Holy song - gain random resources based on played card rarity (Common - 1, Uncommon - 2, Rare - 5). Replace highest rarity Demonic or Undead card from opponent's hand of the same or lower rarity as the played card with [card=381/].</description>
    <lore><![CDATA[<p>People with spiritual talents who dislike the corrupting nature of magic often decide to become priests instead of mages. Priests use their talents to heal and protect their allies, also at a time of need they are able to call to their deity for intervention. In addition, they are the most effective weapon against both demons and the undead. An undead killed by a priest can't be reanimated ever again.</p>]]></lore>
    <code><![CDATA[
    // target card is discarded only if it has same or lower rarity than the played card
    $rarities = ['Common' => 0, 'Uncommon' => 1, 'Rare' => 2];
    $storage = ['Common' => array(), 'Uncommon' => array(), 'Rare' => array()];
    $resources = ['Common' => 1, 'Uncommon' => 2, 'Rare' => 5];
    $played_rank = $rarities[$t->card()->getRarity()];
    $t->myData()->addRandomResources($resources[$t->card()->getRarity()]);

    for ($i = 1; $i <= $t->handSize(); $i++) {
      $dis_card = $this->getCard($t->hisData()->Hand[$i]);
      $dis_rarity = $dis_card->getRarity();
      $dis_rank = $rarities[$dis_rarity];

      // pick only cards that can be discarded by played card
      if (($dis_card->hasKeyword('Demonic') || $dis_card->hasKeyword('Undead')) && $dis_rank <= $played_rank) {
        $storage[$dis_rarity][] = $i;
      }
    }

    if ((count($storage['Common']) + count($storage['Uncommon']) + count($storage['Rare'])) > 0) {
      // pick preferably cards with higher rarity, but choose random card within the rarity group
      shuffle($storage['Common']); shuffle($storage['Uncommon']); shuffle($storage['Rare']);
      $storage_temp = array_merge($storage['Common'], $storage['Uncommon'], $storage['Rare']);
      $discarded_pos = array_pop($storage_temp);
      $this->setCard('his', $discarded_pos, 381, ['reveal' => true]);
    }
]]></code>
  </keyword>
  <keyword>
    <name>Horde</name>
    <basic_gain>0</basic_gain>
    <bonus_gain>0</bonus_gain>
    <description>Fear - if played card is adjacent to a Horde card and recruits cost of the played card is greater than recruits cost of the matching card replace equal or lower rarity matching card with [card=297/].</description>
    <lore><![CDATA[<p>Fear is an effective tool in any war. Enemies of the Horde had many opportunities to witness the effectiveness of such tactic. Broken formations, chaotic retreat and disobedience of orders often lead to loss of the entire army.</p>]]></lore>
    <code><![CDATA[
    if (($t->cardPos() > 1 && $this->getCard($t->myData()->Hand[$t->cardPos() - 1])->hasKeyword('Horde'))
      || ($t->cardPos() < $t->handSize() && $this->getCard($t->myData()->Hand[$t->cardPos() + 1])->hasKeyword('Horde'))) {
      $rarities = ['Common' => 0, 'Uncommon' => 1, 'Rare' => 2];
      $recruits = $t->card()->getResources('Recruits');

      $matching_card = $this->getCard($t->hisData()->Hand[$t->cardPos()]);
      if ($rarities[$t->card()->getRarity()] >= $rarities[$matching_card->getRarity()] && $recruits > $matching_card->getResources('Recruits')) {
        $this->setCard('his', $t->cardPos(), 297, ['reveal' => true]);
      }
    }
]]></code>
  </keyword>
  <keyword>
    <name>Illusion</name>
    <basic_gain>0</basic_gain>
    <bonus_gain>0</bonus_gain>
    <description>Suggestion - if an Illusion card is played after playing a different non-common Illusion card, lowest rarity card in hand is replaced with a rare card from opponent's deck.</description>
    <lore><![CDATA[<p>Illusion magic manipulates the environment rather than the target. Within the changed environment the target becomes confused and often the whole damage done by the spell is done by the target itself. Illusion mages often play important rules in political intrigues.</p>]]></lore>
    <code><![CDATA[
    if ($t->myLastCard()->hasKeyword('Illusion') && $t->myLastAction() == 'play'
      && $t->myLastCard()->getRarity() != 'Common' && $t->card()->id() != $t->myLastCard()->id()) {
      $storage = ['Common' => array(), 'Uncommon' => array(), 'Rare' => array()];
      for ($i = 1; $i <= $t->handSize(); $i++) {
        $cur_card = $this->getCard($t->myData()->Hand[$i]);
        $rarity = $cur_card->getRarity();
        if ($i != $t->cardPos()) {
          $storage[$rarity][] = $i;
        }
      }
      if ((count($storage['Common']) + count($storage['Uncommon']) + count($storage['Rare'])) > 0) {
        shuffle($storage['Common']);
        shuffle($storage['Uncommon']);
        shuffle($storage['Rare']);
        $storage_temp = array_merge($storage['Common'], $storage['Uncommon'], $storage['Rare']);
        $discarded_pos = array_shift($storage_temp);
        $this->setCard('my', $discarded_pos, $this->drawCard($t->hisDeck()->Rare, $t->myData()->Hand, $discarded_pos, 'drawCardList'));
      }
    }
]]></code>
  </keyword>
  <keyword>
    <name>Legend</name>
    <basic_gain>0</basic_gain>
    <bonus_gain>0</bonus_gain>
    <description>Forgotten power - if there is a rare card in hand (other than played card), raises lowest facility by one.</description>
    <lore><![CDATA[<p>Legendary creatures are often present in fairy tales. Rumors say that those who are able to spot these creatures will receive their blessing. Although it's difficult to verify if the rumors are true, some legendary creatures were sighted as they were fighting battles as an ally of one of the factions for unknown reasons. Some say they are attracted to higher magic, others say that they just came to help to even the balance.</p>]]></lore>
    <code><![CDATA[
    for ($i = 1; $i <= $t->handSize(); $i++) {
      // played card does not count
      if ($i != $t->cardPos()) {
        $cur_card = $this->getCard($t->myData()->Hand[$i]);
        if ($cur_card->getRarity() == 'Rare') {
          $t->myData()->addLowestFacility(1);
          break;
        }
      }
    }
]]></code>
  </keyword>
  <keyword>
    <name>Mage</name>
    <basic_gain>10</basic_gain>
    <bonus_gain>3</bonus_gain>
    <description>Willpower - if (Magic - Enemy magic &lt; 2) Magic: +1 else Gems: +10</description>
    <lore><![CDATA[
    <p>Creatures with magical talents often become mages. Mages are irreplaceable in some tasks therefore they are valued in both times of war and times of peace. Mages form groups which are usually dedicated to some special art of magic. Most of the magic schools are official, but there are also those who practice forbidden arts.</p>
    <p>Mages have the ability to focus their spiritual energy thus improving their magical abilities.</p>
]]></lore>
    <code><![CDATA[
    if ($t->myData()->Magic <= ($t->hisData()->Magic + 1)) {
      $t->myData()->addMagic(1);
    }
    else {
      $t->myData()->addGems(10);
    }
]]></code>
  </keyword>
  <keyword>
    <name>Nature</name>
    <basic_gain>0</basic_gain>
    <bonus_gain>0</bonus_gain>
    <description>Overgrowth - if a Nature card is played after playing a different non-common Nature card, summons a rare Nature card.</description>
    <lore><![CDATA[<p>Nature magic is rarely understood by humans. Being chaotic and unpredictable it's the opposite of the magic commonly used by humans, therefore only few have been able to master it. In addition, nature magic is also about life and death, which often leads to arts that are forbidden by many factions.</p>]]></lore>
    <code><![CDATA[
    if ($t->myLastCard()->hasKeyword('Nature') && $t->myLastAction() == 'play'
      && $t->myLastCard()->getRarity() != 'Common' && $t->card()->id() != $t->myLastCard()->id()) {
      $t->nextCard($this->drawCard($this->getList(['rarity'=>'Rare', 'keyword'=>'Nature']), $t->myData()->Hand, $t->cardPos(), 'drawCardList'));
    }
]]></code>
  </keyword>
  <keyword>
    <name>Quick</name>
    <basic_gain>0</basic_gain>
    <bonus_gain>0</bonus_gain>
    <description>Player gets an additional turn, but no production this turn. It is impossible to draw a rare card after a Quick card is played.</description>
    <lore><![CDATA[<p>Creatures with awesome speed are known and feared even though they are usually only lightly armored and have inferior combat capabilities. Their greatest strength is their ability to strike without the fear of retaliation from the enemy. They usually form special harassing units that are used in independent operations to weaken the enemy before the main army arrives.</p>]]></lore>
    <code><![CDATA[$t->addExtraTurn(); $t->production()->multiply(0);]]></code>
  </keyword>
  <keyword>
    <name>Rebirth</name>
    <basic_gain>0</basic_gain>
    <bonus_gain>0</bonus_gain>
    <description>If #Burning + #Demonic + #Legend + #Mage in hand is greater than 3, the card stays in hand and half of the gems cost of the played card will be returned.</description>
    <lore><![CDATA[<p>Ancient creatures are often very difficult to defeat, but most feared are those who will not die on defeat, they will just be reborn and will continue the fight once again. However, they are not immortal. To be successfully reborn they need to draw power from their environment. Once they have depleted all the reserves they will meet their final death.</p>]]></lore>
    <code><![CDATA[
    $count = $this->keywordCount($t->myData()->Hand, 'Burning') + $this->keywordCount($t->myData()->Hand, 'Demonic') + $this->keywordCount($t->myData()->Hand, 'Legend') + $this->keywordCount($t->myData()->Hand, 'Mage');
    if ($count > 3) {
      $t->noNextCard();
      $this->revealCard('my', $t->cardPos());
      $t->myData()->addGems(round($t->card()->getResources('Gems') / 2));
    }
]]></code>
  </keyword>
  <keyword>
    <name>Restoration</name>
    <basic_gain>0</basic_gain>
    <bonus_gain>0</bonus_gain>
    <description>Countermeasures - if opponent lowered your stock last round, your lowest resource is raised based on played card rarity (C-3, U-6, R-9). If opponent lowered your facilities last round you gain 1 of your lowest facility if it's less than N, N is based on played card rarity (C-2, U-3, R-4).</description>
    <lore><![CDATA[<p>Restoration magic is one of the most commonly used art of magic. Most factions support schools that teach this art, because its usage is very wide and safe. Restoration mages are the most accepted mages in the society. If their skills are exceptional they can even be promoted to nobility.</p>]]></lore>
    <code><![CDATA[
    if ($t->myChange('Bricks') < 0 || $t->myChange('Gems') < 0 || $t->myChange('Recruits') < 0) {
      $rarities = ['Common' => 3, 'Uncommon' => 6, 'Rare' => 9];
      $t->myData()->addLowestResource($rarities[$t->card()->getRarity()]);
    }
    if ($t->myChange('Quarry') < 0 || $t->myChange('Magic') < 0 || $t->myChange('Dungeons') < 0) {
      $rarities = ['Common' => 2, 'Uncommon' => 3, 'Rare' => 4];
      $chosen = $t->myData()->detectLowestFacility();
      if ($t->myData()->$chosen < $rarities[$t->card()->getRarity()]) {
        if ($chosen == 'Quarry') {
          $t->myData()->addQuarry(1);
        }
        elseif ($chosen == 'Magic') {
          $t->myData()->addMagic(1);
        }
        elseif ($chosen == 'Dungeons') {
          $t->myData()->addDungeons(1);
        }
      }
    }
]]></code>
  </keyword>
  <keyword>
    <name>Runic</name>
    <basic_gain>0</basic_gain>
    <bonus_gain>0</bonus_gain>
    <description>Reconstruction - if Tower or Wall was damaged during opponent's last round, Tower or Wall is raised based on played card rarity (C-2, U-5, R-10). Tower or Wall increase can't exceed the damage which was inflicted on Tower or Wall.</description>
    <lore><![CDATA[
    <p>Dwarves are well known for their technological superiority, mining and weapon forging. Additionally, they have rune magic at their disposal. Dwarven country is called the Runic league which is ruled by the Mountain king. Dwarven society consists of common folk, noble houses and the Runic circle. The Runic circle supervises the usage of rune magic and thus is powerful and influential. The dwarves are a defensive faction. They prefer to stay safely behind their strong fortifications.</p>
    <p>Technological dominance and rune magic allows the dwarves to construct sturdy fortifications that can be repaired very quickly and efficiently.</p>
]]></lore>
    <code><![CDATA[
    $rarities = ['Common' => 2, 'Uncommon' => 5, 'Rare' => 10];
    $factor = $rarities[$t->card()->getRarity()];
    if ($t->myChange('Tower') < 0) {
      $tower_damage = $t->myChange('Tower') * (-1);
      $t->myData()->addTower(min($tower_damage, $factor));
    }
    if ($t->myChange('Wall') < 0) {
      $wall_damage = $t->myChange('Wall') * (-1);
      $t->myData()->addWall(min($wall_damage, $factor));
    }
]]></code>
  </keyword>
  <keyword>
    <name>Siege</name>
    <basic_gain>0</basic_gain>
    <bonus_gain>0</bonus_gain>
    <description>Demolition - if played card damages opponent's Tower or Wall and opponent raised his Tower or Wall last round, he suffers additional damage to Tower or Wall based on played card rarity (C-1, U-2, R-5) for Tower and (C-2, U-4, R-10) for Wall. The additional damage can't exceed the Tower or Wall increase.</description>
    <lore><![CDATA[<p>Powerful creatures and war machines are often used as a siege weapons during the battle. Their attack is so powerful that fortifications that were built only recently may fail to endure such force and break apart.</p>]]></lore>
    <code><![CDATA[
    $rarities = ['Common' => 1, 'Uncommon' => 2, 'Rare' => 5];
    $factor = $rarities[$t->card()->getRarity()];
    if ($t->hisChange('Tower') > 0 && $t->hisDataInit()['Tower'] > $t->hisData()->Tower) {
      $t->hisData()->addTower(-min($t->hisChange('Tower'), $factor));
    }

    if ($t->hisChange('Wall') > 0 && $t->hisDataInit()['Wall'] > $t->hisData()->Wall) {
      $t->hisData()->addWall(-min($t->hisChange('Wall'), 2 * $factor));
    }
]]></code>
  </keyword>
  <keyword>
    <name>Skirmisher</name>
    <basic_gain>0</basic_gain>
    <bonus_gain>0</bonus_gain>
    <description>Harass - discard highest rarity Charge from opponent's hand. Common cards can target common and uncommon cards, uncommon and rare cards can target any rarity. Rare cards replace target card with a common zero cost card instead of discarding it. If there are no Charge cards in opponent's hand, highest rarity Recruits only attack card of the same or lower rarity as the played card is chosen instead.</description>
    <lore><![CDATA[<p>Skirmishers are troops designed to counter enemy cavalry. Their combat capabilities may be inferior, but their role is crucial in any army. They are trained to protect their allies at all costs and down to the last man.</p>]]></lore>
    <code><![CDATA[
    // target card is discarded only if it has same or lower rarity than the played card
    $rarities = ['Common' => 0, 'Uncommon' => 1, 'Rare' => 2];
    $storage = $r_storage = ['Common' => array(), 'Uncommon' => array(), 'Rare' => array()];
    $played_rank = $rarities[$t->card()->getRarity()];
    $secondary_cards = $this->getList(['cost'=>'Green', 'advanced'=>'Attack:']);

    for ($i = 1; $i <= $t->handSize(); $i++) {
      $dis_card = $this->getCard($t->hisData()->Hand[$i]);
      $dis_rarity = $dis_card->getRarity();
      $dis_rank = $rarities[$dis_rarity];

      // pick only cards that can be discarded by played card
      if ($dis_card->hasKeyword('Charge') && $dis_rank <= ($played_rank + 1)) {
        $storage[$dis_rarity][] = $i;
      }
      elseif ($dis_rank <= $played_rank && in_array($t->hisData()->Hand[$i], $secondary_cards)) {
        $r_storage[$dis_rarity][] = $i;
      }
    }

    // use secondary storage if primary storage is empty
    if ((count($storage['Common']) + count($storage['Uncommon']) + count($storage['Rare'])) == 0) {
      $storage = $r_storage;
    }

    if ((count($storage['Common']) + count($storage['Uncommon']) + count($storage['Rare'])) > 0) {
      // pick preferably cards with higher rarity, but choose random card within the rarity group
      shuffle($storage['Common']);
      shuffle($storage['Uncommon']);
      shuffle($storage['Rare']);
      $storage_temp = array_merge($storage['Common'], $storage['Uncommon'], $storage['Rare']);
      $discarded_pos = array_pop($storage_temp);

      if ($t->card()->getRarity() == 'Rare') {
        $new_card = $this->drawCard($this->getList(['rarity'=>'Common', 'cost'=>'Zero']), $t->hisData()->Hand, $discarded_pos, 'drawCardList');
      }
      else {
        $new_card = $this->drawCard($t->hisDeck(), $t->hisData()->Hand, $discarded_pos, 'drawCardDifferent');
      }
      $this->setCard('his', $discarded_pos, $new_card);
    }
]]></code>
  </keyword>
  <keyword>
    <name>Soldier</name>
    <basic_gain>15</basic_gain>
    <bonus_gain>10</bonus_gain>
    <description>Veteran troops - half of the recruits cost of the played card will be returned.</description>
    <lore><![CDATA[
    <p>Human soldiers are the most common fighting force. Relatively cheap and effective in great numbers. Weapons and fighting techniques are different for each province, therefore soldiers are able to adapt to any environment and fighting style. Soldiers that are able to withstand multiple battles returns as veterans to fight another day.</p>
]]></lore>
    <code><![CDATA[$t->myData()->addRecruits(round($t->card()->getResources('Recruits') / 2));]]></code>
  </keyword>
  <keyword>
    <name>Swift</name>
    <basic_gain>0</basic_gain>
    <bonus_gain>0</bonus_gain>
    <description>Player gets additional turn, also with production. It is impossible to draw a rare card after a Swift card is played.</description>
    <lore><![CDATA[<p>Creatures that possess the talent to use magic to manipulate time are extremely rare. Mages that mastered this art can be seen in two places at once or not at all. They are usually used for missions were they need to get in, get the job done and get out without anyone noticing.</p>]]></lore>
    <code><![CDATA[$t->addExtraTurn();]]></code>
  </keyword>
  <keyword>
    <name>Titan</name>
    <basic_gain>19</basic_gain>
    <bonus_gain>5</bonus_gain>
    <description>Titan's will - summons a Titan not present in hand.</description>
    <lore><![CDATA[<p>One of the titans who didn't get eradicated by the gods was smashed to pieces. Although each piece is alive and can be used as a separate, anyone who is able to find all the pieces and complete them into the greater whole will possess an unstoppable war machine which is feared even by gods.</p>]]></lore>
    <code><![CDATA[
    $hand = $t->myData()->Hand; unset($hand[$t->cardPos()]);
    $titans = array_diff($this->getList(['keyword'=>'Titan']), $hand);
    if (count($titans) > 0) {
      $t->nextCard($this->drawCard($titans, $t->myData()->Hand, $t->cardPos(), 'drawCardList'));
    }
    ]]></code>
  </keyword>
  <keyword>
    <name>Undead</name>
    <basic_gain>5</basic_gain>
    <bonus_gain>5</bonus_gain>
    <description>Eternal servitude - a part of the total cost of the played card will be returned. Returned amount is based on number of different resources present in the card cost (3 - third, 2 - half, 1 - two thirds).</description>
    <lore><![CDATA[<p>Mages that were corrupted by the promise of eternal life are transformed to liches. These powerful creatures are able to conjure vast armies of undead to fight for their cause. An undead can't die, therefore much of the corpses can be reanimated after the battle to plague the living once again.</p>]]></lore>
    <code><![CDATA[
    $coef = (($t->card()->getResources('Bricks') > 0) ? 1 : 0) + (($t->card()->getResources('Gems') > 0) ? 1 : 0) + (($t->card()->getResources('Recruits') > 0) ? 1 : 0);
    $bonuses = [0 => 0, 1 => 2/3, 2 => 1/2, 3 => 1/3];
    $bonus = $bonuses[$coef];
    $t->myData()
      ->addBricks(round($t->card()->getResources('Bricks') * $bonus))
      ->addGems(round($t->card()->getResources('Gems') * $bonus))
      ->addRecruits(round($t->card()->getResources('Recruits') * $bonus));
]]></code>
  </keyword>
  <keyword>
    <name>Unliving</name>
    <basic_gain>9</basic_gain>
    <bonus_gain>8</bonus_gain>
    <description>Artificial workers - additional bricks production based on played card rarity (Common - x2, Uncommon - x3, Rare - x4).</description>
    <lore><![CDATA[<p>Artificial soldiers that lack free will or the concepts of mercy or morale are the dwarven answer to the dreaded undead hordes. Golems are expendable and perform better in battle than dozens of dwarves. They are created and controlled by the golem masters - rune mages who are specialized in manipulation and animation runes. Even if golem is defeated, its material can be reused to built antoher golem making them one of the most cost-efficient soldiers.</p>]]></lore>
    <code><![CDATA[$b_prod = ['Common' => 2, 'Uncommon' => 3, 'Rare' => 4]; $t->production()->multiplyBricks($b_prod[$t->card()->getRarity()]);]]></code>
  </keyword>
</keywords>
